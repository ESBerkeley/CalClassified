{% extends "base.html" %}

{% block title %}BuyNearMe - Browse{% endblock %}

{% block head %}
  {% load static %}
  <!-- Styles -->
  <style type="text/css">
    .navbar-inner {
        min-width: 1150px;
    }
  </style>
{% endblock %}

{% block url_metadata %}
  <meta property="og:url" content="http://buynear.me/browse/"/>
{% endblock %}

{% block voteSTC %}{% endblock %}

{% block sidebar %}
     <!--div id="voteSTC2013" style="background-color: #dddddd; height: 30px; padding: 3px; border-bottom:#d0d0d0 1px solid; margin-top: -15px;">
        <center style="margin: 0; padding: 0; padding-top: 5px; font-family: 'Source Sans Pro', sans-serif;">
          <a style="font-size: 19px;" onclick="window.open(this.href); return false;" 
onkeypress="window.open(this.href); return false;" href="http://www.surveygizmo.com/s3/1208804/STC-Web-App-Competition-2013-The-People-s-Choice-Awards">
          Please support us by voting BuyNearMe in the STC Web App Competition! Click Here!
          </a>
        </center>
      </div-->

<div class="sidebar-container">
  <div class="row">
    <div class="accordion sidebar-nav span3" id="accordion1">

      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapseOne">
            <h2>Select Category</h2>
          </a>
        </div>
        <div id="collapseOne" class="accordion-body collapse">
          <div class="accordion-inner">
            <ul class="unstyled">
              <li class="side-item">
                <i id="Everything-icon" class="icon-ok-sign side-icon cat-icon" type="hidden" onclick="allCat(); toggler('Everything-icon'); searchToggle('Everything'); runloadBox();"></i>
                <a id="Everything_category" class="side-text" onclick="allCat(); toggler('Everything-icon'); searchToggle('Everything'); runloadBox();"> Everything </a>
              </li>
              {% for cat in cc_cats %}
                {% if cat.name != "Other" %}
                <li class="side-item">
                  <i id="{{cat.name}}-icon" class="icon-ok-sign side-icon cat-icon" type="hidden" onclick="switchCat('{{cat.name}}'); toggler('{{cat.name}}-icon'); searchToggle('{{cat.name}}'); runloadBox();"></i>
                  <a id="{{cat.name}}_category" class="side-text" onclick="switchCat('{{cat.name}}'); toggler('{{cat.name}}-icon'); searchToggle('{{cat.name}}'); runloadBox();"> {{cat.name}} </a>
                </li>
                {% endif %}
              {% endfor %}
              <li class="side-item">
                <i id="Other-icon" class="icon-ok-sign side-icon cat-icon" type="hidden" onclick="switchCat('Other'); toggler('Other-icon'); searchToggle('Other'); runloadBox();"></i>
                <a id="Other_category" class="side-text" onclick="switchCat('Other'); toggler('Other-icon'); searchToggle('Other'); runloadBox();"> Other </a>
              </li>

{% comment %}
              {% if user.get_profile.facebook_id %}
              <hr style="margin-top:6px; margin-bottom:3px;">
              <li class="side-item circle_side-item">
                <i id="friend-icon" class="icon-ok-sign side-icon" type="hidden" onclick="toggle_friends_filter();"></i>
                <a id="" class="circle" onclick="toggle_friends_filter();"/> Friends Only </a>
              </li>
              {% endif %}
{% endcomment %}
            </ul>
          </div>
        </div>
      </div>

{% comment %}
      {% if not circle %} <!--hides circles section if in specific circle page -->
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapseTwo">
            <h2>Show Groups  <i class="icon-question-sign tooltips" style="margin-left:5px; margin-top:4px;" rel="tooltips" data-placement="right" data-original-title="Filter by groups you're in!"></i></h2>
          </a>
        </div>
        <div id="collapseTwo" class="accordion-body collapse">
          <div class="accordion-inner">
            <ul class="unstyled">
              {% for entry in my_public_circles %}
                <li class="side-item circle_side-item">
                  <i id="{{entry.id}}-icon-circle" class="icon-ok-sign side-icon" type="hidden" onclick="switchCirc('{{entry.id}}'); toggler('{{entry.id}}-icon-circle'); runloadBox();"></i>
                  <a id="{{entry.id}}_circle" class="side-text" onclick="switchCirc('{{entry.id}}'); toggler('{{entry.id}}-icon-circle'); runloadBox();"/> {{entry.name}} </a>
                </li>
              {% endfor %}
          
              {% if my_private_circles  %} <!-- private won't exist if user not logged in, circle variable passed in when in viewing a circle -->
              {% for entry in my_private_circles %}
                <li class="side-item circle_side-item">
                  <i id="{{entry.id}}-icon-circle" class="icon-ok-sign side-icon" type="hidden" onclick="switchCirc('{{entry.id}}'); toggler('{{entry.id}}-icon-circle'); runloadBox();"></i>
                  <a id="{{entry.id}}_circle" class="side-text" onclick="switchCirc('{{entry.id}}'); toggler('{{entry.id}}-icon-circle'); runloadBox();"/> {{entry.name}} </a>
                </li>
              {% endfor %}
              {% endif %}

              {% if not my_public_circles and not my_private_circles %}
              <li>
                <p>
                  Add groups to filter by location or community.
                </p>
                <a class="btn btn-small btn-success" href="{% url account_circles %}">Add Groups</a>
              </li>
              {% endif %} 
              
            </ul>
          </div>
        </div>
      </div>
      {% endif %} <!-- end if not circle -->
{% endcomment %}
    
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapse2">
            <h2>Sort By</h2>
          </a>
        </div>
        
        <div id="collapse2" class="accordion-body collapse">
          <div class="accordion-inner">
            <ul class="unstyled">
              <li class="side-item">
                <i id="dateNew" class="icon-ok-sign side-icon order-icon" onclick="selectOrder('dateNew'); runloadBox();"></i>
                <a id="" class="side-text order-text" onclick="selectOrder('dateNew'); runloadBox();"/>Date: Newest First</a>
              </li>
              <!--li class="side-item">
                <i id="dateOld" class="icon-ok-sign side-icon order-icon" onclick="selectOrder('dateOld'); runloadBox();"></i>
                <a id="" class="side-text order-text" onclick="selectOrder('dateOld'); runloadBox();"/>Date: Oldest First</a>
              </li--><!-- No Date Oldest First, makes no sense-->
              <li class="side-item">
                <i id="priceLow" class="icon-ok-sign side-icon order-icon" onclick="selectOrder('priceLow'); runloadBox();"></i>
                <a id="" class="side-text order-text" onclick="selectOrder('priceLow'); runloadBox();"/>Price: Lowest First</a>
              </li>
              <li class="side-item">
                <i id="priceHigh" class="icon-ok-sign side-icon order-icon" onclick="selectOrder('priceHigh'); runloadBox();"></i>
                <a id="" class="side-text order-text" onclick="selectOrder('priceHigh'); runloadBox();"/>Price: Highest First</a>
              </li>
            </ul>
          </div>
        </div>  
      </div>

      {% if user.get_profile.facebook_id %}
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapse3">
            <h2>Connections</h2>
          </a>
        </div>
        <div id="collapse3" class="accordion-body collapse">
          <div class="accordion-inner">
            <ul class="unstyled">
              <li class="side-item">
                <i id="friend-icon" class="icon-ok-sign side-icon" type="hidden" onclick="toggle_friends_filter();"></i>
                <a id="" class="side-text" onclick="toggle_friends_filter();"/> Friends Only </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      {% endif %}

      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapse4">
            <h2>Price</h2>
          </a>
        </div>
        <div id="collapse4" class="accordion-body collapse">
          <div class="accordion-inner">
            <ul class="unstyled">
              <li class="side-item">
                <form class="form-inline price-box" action="javascript:runloadBox();">
                  <input id="min" type="text" class="input-mini" placeholder="Low"> ~
                  <input id="max" type="text" class="input-mini" placeholder="High" style="margin-right:8px;">
                  <i id="price-go" class="icon-arrow-right price-icon" type="submit" class="submit" onclick="runloadBox();"></i>
                  <i id="price-cancel" class="icon-remove price-icon" type="submit hidden" onclick="priceboxCancel();"></i>
                  <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;"/> <!--invisible button makes enter work -->
                </form>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div><!--span-->
{% endblock %}

{% block content %}



    <div id="boxDiv" class="span9 offset3">
      {% if cc_circs|length == -1 %}
        <!--<h2><a href="{% url account_circles %}">Join</a> groups to see what people are selling!</h2>-->
      {% else %}
      <div class="stopfloat"><br/>
        <div id="myBox" style="position:relative; left:10px;">
          <div id="myBox0" style="position:relative; top:0px;">
           
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div><!-- end sidebar -->

<div id="pac-ajax">
  <h4 style="color:white">Loading . . . <img src="{{ STATIC_URL }}images/pacman-ajax-flipped.gif" style="" /> </h4>
</div>

  <form style="display: none;" id="session">
   <textarea id="sfield">3</textarea>
  </form>

  <form style="display: none;" id="session">
   <textarea id="sfield_scroll">3</textarea>
  </form>
  

{% endblock %}


{% block post_js %}

<script type="text/javascript">
  $(".side-icon").hide();  //hides sidebar icons initially
  $("#Everything-icon").show(); //shows the Everything filter icon
  $(".popovers").popover({trigger:'hover'});


  $(window).scroll(function(){


    if(!in_restore && $(window).scrollTop() >= $(document).height() - 22 - $(window).height()){
      current_page++;
      runloadBox(current_page);

    }
  });


  $(document).ready(function(){
      $(".navbar").addClass("navbar-fixed-top");
      $("body").css("padding-top","+=70px");
      $(".navbar .container").css("min-width","96.5%");
 
    document.getElementById("searchbarform").setAttribute("action","javascript: runloadBox();");
//    document.getElementById("searchbarform").setAttribute("action","javascript: alert('asdfasd');")

    {% if q %}
      document.getElementById('searchbar').value = "{{ q }}";
    {% endif %}
    
     
    if($.cookie('onpost') === 't'){
       in_restore = 1;
       $.cookie('onpost',null);
       $.cookie('onpost','f', { expires: 1, path: '/' } );
       restore();
    }

   else{     
        clear_restore();
        runloadBox();
    }






  });


  var in_restore = 0;
  var ogrid,old_obj,scraps,oflags;
  scraps=[];
  oflags="";
  var current_page = 0;
  var cat_object = {};
  var circ_object = {};
  var categories = [];
  var circles = [];
  var filtering_by_friends = 0;


  var numx = 4;
  var heights = new Array();
  for(var i = 0; i < numx; i++){
    heights[i] = 0;
  }


  {% for entry in cc_cats %}  //all categories and circles are initially false
    categories.push("{{entry.name}}")
  {% endfor %}
  for (index in categories) {
    cat = categories[index];
    cat_object[cat] = false;
  }

  {% for entry in cc_circs %}  //circles
    circles.push("{{entry.id}}")
  {% endfor %}
  for (index in circles) {
    circ = circles[index];
    circ_object[circ] = false;
  }  

  function scats(input){
    var ii = 0;
    var cat;
    for(i in categories){
        cat = categories[i];
        if((1<<ii)&input){
            if(!cat_object[cat]) toggler(categories[i] + "-icon");
            cat_object[cat] = true;
        }
        else{
            if(cat_object[cat]) toggler(categories[i] + "-icon");
            cat_object[cat] = false;
        }
        ii = ii + 1; 
    }
  }
  
  function scircs(input){
    var ii = 0;
    var circ;
    for(i in circles){
        circ = circles[i];
        if((1<<ii)&input){
            if(!circ_object[circ]) toggler(circles[i] + "-icon");
            circ_object[circ] = true;
        }
        else{
            if(circ_object[circ]) toggler(circles[i] + "-icon");
            circ_object[circ] = false;
        }
        ii = ii + 1; 
    }
  }
  
  function gcats(){
    var k = 0; 
    var j = -1;
    for(i in categories){    
      j=j+1;
      var cat = categories[i];
      if(cat_object[cat] == true){
        k=k+(1<<j);
      }
    }
    return k;
  }

  function gcircs(){
    var k = 0; 
    var j = -1;
    for(i in circles){    
      j=j+1;
      var circ = circles[i];
      if(circ_object[circ] == true){
        k=k+(1<<j);
      }
    }
    return k;
  }
  
  function num2cat(num) {  //takes in number, spits out category string.
    {% for cat in cc_cats %}
      if(num == {{cat.pk}}) {
        return "{{cat.name}}";
      }
    {% endfor %}
    return "whoops";
  }
  
  function cat2num(cat_name) { //takes in a category name, and returns category pk
    {% for cat in cc_cats %}
      if(cat_name == "{{cat.name}}") {
        return {{cat.id}};
      }
    {% endfor %}
    return "whoops";
  }
  
    function cir2num(cir_name) { //takes in a category name, and returns category pk
    {% for cir in cc_circs %}
      if(cir_name == "{{cir.name}}") {
        return {{cir.id}};
      }
    {% endfor %}
    return "whoops";
  }

/* OLD
  function switchCat(category) {  //run on click, switches boolean
    cat_object[category] = !cat_object[category];
  }
*/

  function switchCat(category) {  //sets all categories to false first, then sets specific one to true.
    for(cat in cat_object) {
      cat_object[cat] = false;
    }
    cat_object[category] = true;
  }

  function allCat() {
    for(cat in cat_object) {
      cat_object[cat] = true;
    }
  }

  function getCats() {
    var hasTrue = false;
    var cat_object2 = {};
    for (index in categories) {  //checks if any categories are "checked", if not, returns as all true object
      cat = categories[index];
      if(cat_object[cat]) {
        hasTrue = true;
      }
    }
    if(hasTrue) {
      return cat_object;
    } else {
      for (index in categories) {
        cat = categories[index];
        /*if (index != 5) { //TAKE OUT FACEBOOK POSTS FROM NORMAL BOX UNLESS CLICKED ON!
           cat_object2[cat] = true;
        }*/
      }
      return cat_object2;
    }
  }
  
  function switchCirc(circle) {  //run on click, switches boolean
    circ_object[circle] = !circ_object[circle];
  }

  function getCircs(){
    var hasTrue = false;
    var circ_object2 = {};
    for (index in circles) {  //checks if any categories are "checked", if not, returns as all true object
      circ = circles[index];
      if(circ_object[circ]) {
        hasTrue = true;
      }
    }
    if(hasTrue) {
      return circ_object;
    } else {
      for (index in circles) {
        circ = circles[index];
        circ_object2[circ] = true;
      }
      return circ_object2;
    }
  }

  //be careful with order values, they get passed to server
  var order = 'dateNew';
  $('#dateNew').show();

  function selectOrder(value) {
    order = value;
    $('.order-icon').hide();
    $('#'+order).show();        //html ids for icons equivalent to the order values
  }

/* OLD SYSTEM
  function switchDate() {
    $('#order-date-icon').show();
    $('#order-price-icon').hide();
    $('#order-price-text').html('Price');
    if(order == 'dateNew') {
      order = 'dateOld';
      $('#order-date-text').html('Date: Oldest First');
    }
    else {
      order = 'dateNew';
      $('#order-date-text').html('Date: Newest First');
    }
  }

  function switchPrice() {
    $('#order-date-icon').hide();
    $('#order-price-icon').show();
    $('#order-date-text').html('Date');
    if(order == 'priceLow') {
      order = 'priceHigh';
      $('#order-price-text').html('Price: Highest First');
    } 
    else {
      order = 'priceLow';
      $('#order-price-text').html('Price: Lowest First');
    }
  }
*/

  function getOrder() {
    return order;
  }

  function toggle_friends_filter(){
    filtering_by_friends=!filtering_by_friends;
    $('#friend-icon').toggle();
    runloadBox(current_page);
  }
</script>
{% endblock %}

{% block footer %}{% endblock %}








